<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">Declaraciones</h2>
    <button class="btn btn-success" (click)="navigateToNewDeclaration()">
      <i class="bi bi-plus-lg me-1"></i> Nueva Declaración
    </button>
  </div>

  <!-- ⚠️ AVISO IMPORTANTE -->
  <div class="alert alert-warning d-flex align-items-center gap-2" role="alert">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <div>
      Una vez que una declaración tenga el análisis generado, no podrá ser eliminada ni editada.
    </div>
  </div>

  <div *ngIf="declarations.length === 0" class="text-center text-muted py-5">
    <i class="bi bi-chat-left-text fs-1"></i>
    <p class="mt-3">No hay declaraciones registradas.</p>
  </div>

  <div class="row gy-4" *ngIf="declarations.length > 0">
    <div class="col-md-6 col-lg-4" *ngFor="let declaration of declarations">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <img [src]="getPlayerImage(declaration.player_id)" alt="Jugador" class="rounded-circle me-3" width="50"
              height="50" style="object-fit: cover;">
            <div>
              <h5 class="mb-0">{{ getPlayerName(declaration.player_id) }}</h5>
              <small class="text-muted">{{ getPlayerTeam(declaration.player_id) }}</small>
            </div>
          </div>

          <p class="mb-1 text-muted small">Categoría:</p>
          <p class="fw-semibold mb-2">{{ declaration.categoria_texto }}</p>

          <blockquote class="blockquote fst-italic text-secondary mb-3">
            “{{ declaration.texto }}”
          </blockquote>

          <div class="d-flex flex-wrap gap-2">
            <!-- Si ya hay análisis, muestra botón para verlo -->
            <button *ngIf="nlpAnalyses.has(declaration.id!)" class="btn btn-outline-primary btn-sm"
              (click)="goToAnalysis(declaration.id!)">
              Ver Análisis
            </button>

            <!-- Si no hay análisis, muestra botón para analizar -->
            <button *ngIf="!nlpAnalyses.has(declaration.id!)" class="btn btn-outline-success btn-sm"
              (click)="generateAnalysis(declaration.id!)">
              Analizar
            </button>

            <button *ngIf="!nlpAnalyses.has(declaration.id!)" class="btn btn-outline-secondary btn-sm"
              (click)="navigateToEditDeclaration(declaration.id!)">
              Editar
            </button>

            <button class="btn btn-outline-danger btn-sm" (click)="deleteDeclaration(declaration.id!)"
              [disabled]="nlpAnalyses.has(declaration.id!)">
              Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>